(function () {
    'use_strict';

    window.node_fetch = (url, options) => {
        if (!options.body) {
            delete options.body;
        } else if (Buffer.isBuffer(options.body)) {
            options.body = options.body.bytebuffer.toBuffer();
        }

        if (options.headers['User-Agent']) {
            delete options.headers['User-Agent'];
        }

        return window.fetch(url, options)
            .then(response => {
                response.buffer = () => {
                    return response.arrayBuffer().then(result => {
                        return {
                            buffer: result,
                            byteOffset: 0,
                            byteLength: result.byteLength
                        };
                    });
                }
                return response;
            });
    }

})();